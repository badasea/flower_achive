# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: Deploy Next.js to GitHub Pages

# ì–¸ì œ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  ê²ƒì¸ì§€ ì •ì˜
on:
  push:
    branches:
      - main # main ë¸Œëœì¹˜ì— push ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰
  # (ì„ íƒì‚¬í•­) Actions íƒ­ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ë„ ìˆë„ë¡ ì„¤ì •
  workflow_dispatch:

# ì‘ì—…(Job)ì„ ìˆ˜í–‰í•  ë•Œ í•„ìš”í•œ ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  pages: write
  id-token: write

# ì–´ë–¤ ì‘ì—…(Job)ì„ ìˆ˜í–‰í•  ê²ƒì¸ì§€ ì •ì˜
jobs:
  # ë¹Œë“œ ì‘ì—…
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4 # 1. ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œë¥¼ ê°€ìƒ í™˜ê²½ìœ¼ë¡œ ë¶ˆëŸ¬ì˜´

      - name: Setup Node.js âš™ï¸
        uses: actions/setup-node@v4 # 2. Node.js í™˜ê²½ ì„¤ì •
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies ğŸ“¦
        run: npm install # 3. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜

      - name: Build project ğŸ”¨
        # basePath ì„¤ì •ì„ ìœ„í•´ package.jsonì˜ build ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •í•  í•„ìš” ì—†ìŒ
        run: npm run build # 4. í”„ë¡œì íŠ¸ ë¹Œë“œ (out í´ë”ì— ê²°ê³¼ë¬¼ì´ ìƒì„±ë¨)

      - name: Upload artifact â¬†ï¸
        uses: actions/upload-pages-artifact@v3 # 5. ë¹Œë“œ ê²°ê³¼ë¬¼ì„ GitHub Pagesì— ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì—…ë¡œë“œ
        with:
          path: ./out # Next.jsì˜ ë¹Œë“œ ê²°ê³¼ë¬¼ í´ë”

  # ë°°í¬ ì‘ì—…
  deploy:
    # build ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ëë‚˜ì•¼ ì‹¤í–‰ë¨
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages ğŸš€
        id: deployment
        uses: actions/deploy-pages@v4 # 6. ì—…ë¡œë“œëœ ê²°ê³¼ë¬¼ì„ GitHub Pagesì— ë°°í¬
